!function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var i,r=t(document);t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(e){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),i=t("meta[name=csrf-param]").attr("content");t('form input[name="'+i+'"]').val(e)},fire:function(e,i,r){var a=t.Event(i);return e.trigger(a,r),a.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(r){var a,n,s,o,c,l,u,h;if(i.fire(r,"ajax:before")){if(o=r.data("cross-domain"),c=o===e?null:o,l=r.data("with-credentials")||null,u=r.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,r.is("form")){a=r.attr("method"),n=r.attr("action"),s=r.serializeArray();var f=r.data("ujs:submit-button");f&&(s.push(f),r.data("ujs:submit-button",null))}else r.is(i.inputChangeSelector)?(a=r.data("method"),n=r.data("url"),s=r.serialize(),r.data("params")&&(s=s+"&"+r.data("params"))):r.is(i.buttonClickSelector)?(a=r.data("method")||"get",n=r.data("url"),s=r.serialize(),r.data("params")&&(s=s+"&"+r.data("params"))):(a=r.data("method"),n=i.href(r),s=r.data("params")||null);return h={type:a||"GET",data:s,dataType:u,beforeSend:function(t,a){return a.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+a.accepts.script),i.fire(r,"ajax:beforeSend",[t,a])?void r.trigger("ajax:send",t):!1},success:function(t,e,i){r.trigger("ajax:success",[t,e,i])},complete:function(t,e){r.trigger("ajax:complete",[t,e])},error:function(t,e,i){r.trigger("ajax:error",[t,e,i])},crossDomain:c},l&&(h.xhrFields={withCredentials:l}),n&&(h.url=n),i.ajax(h)}return!1},handleMethod:function(r){var a=i.href(r),n=r.data("method"),s=r.attr("target"),o=t("meta[name=csrf-token]").attr("content"),c=t("meta[name=csrf-param]").attr("content"),l=t('<form method="post" action="'+a+'"></form>'),u='<input name="_method" value="'+n+'" type="hidden" />';c!==e&&o!==e&&(u+='<input name="'+c+'" value="'+o+'" type="hidden" />'),s&&l.attr("target",s),l.hide().append(u).appendTo("body"),l.submit()},formElements:function(e,i){return e.is("form")?t(e[0].elements).filter(i):e.find(i)},disableFormElements:function(e){i.formElements(e,i.disableSelector).each(function(){i.disableFormElement(t(this))})},disableFormElement:function(t){var i,r;i=t.is("button")?"html":"val",r=t.data("disable-with"),t.data("ujs:enable-with",t[i]()),r!==e&&t[i](r),t.prop("disabled",!0)},enableFormElements:function(e){i.formElements(e,i.enableSelector).each(function(){i.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,r=t.data("confirm"),a=!1;return r?(i.fire(t,"confirm")&&(a=i.confirm(r),e=i.fire(t,"confirm:complete",[a])),a&&e):!0},blankInputs:function(e,i,r){var a,n,s=t(),o=i||"input,textarea",c=e.find(o);return c.each(function(){if(a=t(this),n=a.is("input[type=checkbox],input[type=radio]")?a.is(":checked"):a.val(),!n==!r){if(a.is("input[type=radio]")&&c.filter('input[type=radio]:checked[name="'+a.attr("name")+'"]').length)return!0;s=s.add(a)}}),s.length?s:!1},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var r=t.data("disable-with");t.data("ujs:enable-with",t.html()),r!==e&&t.html(r),t.bind("click.railsDisable",function(t){return i.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},i.fire(r,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,r){t.crossDomain||i.CSRFProtection(r)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableElement(e)})}),r.delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(t(this))}),r.delegate(i.buttonDisableSelector,"ajax:complete",function(){i.enableFormElement(t(this))}),r.delegate(i.linkClickSelector,"click.rails",function(r){var a=t(this),n=a.data("method"),s=a.data("params"),o=r.metaKey||r.ctrlKey;if(!i.allowAction(a))return i.stopEverything(r);if(!o&&a.is(i.linkDisableSelector)&&i.disableElement(a),a.data("remote")!==e){if(o&&(!n||"GET"===n)&&!s)return!0;var c=i.handleRemote(a);return c===!1?i.enableElement(a):c.error(function(){i.enableElement(a)}),!1}return n?(i.handleMethod(a),!1):void 0}),r.delegate(i.buttonClickSelector,"click.rails",function(e){var r=t(this);if(!i.allowAction(r))return i.stopEverything(e);r.is(i.buttonDisableSelector)&&i.disableFormElement(r);var a=i.handleRemote(r);return a===!1?i.enableFormElement(r):a.error(function(){i.enableFormElement(r)}),!1}),r.delegate(i.inputChangeSelector,"change.rails",function(e){var r=t(this);return i.allowAction(r)?(i.handleRemote(r),!1):i.stopEverything(e)}),r.delegate(i.formSubmitSelector,"submit.rails",function(r){var a,n,s=t(this),o=s.data("remote")!==e;if(!i.allowAction(s))return i.stopEverything(r);if(s.attr("novalidate")==e&&(a=i.blankInputs(s,i.requiredInputSelector),a&&i.fire(s,"ajax:aborted:required",[a])))return i.stopEverything(r);if(o){if(n=i.nonBlankInputs(s,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(s)},13);var c=i.fire(s,"ajax:aborted:file",[n]);return c||setTimeout(function(){i.enableFormElements(s)},13),c}return i.handleRemote(s),!1}setTimeout(function(){i.disableFormElements(s)},13)}),r.delegate(i.formInputClickSelector,"click.rails",function(e){var r=t(this);if(!i.allowAction(r))return i.stopEverything(e);var a=r.attr("name"),n=a?{name:a,value:r.val()}:null;r.closest("form").data("ujs:submit-button",n)}),r.delegate(i.formSubmitSelector,"ajax:send.rails",function(e){this==e.target&&i.disableFormElements(t(this))}),r.delegate(i.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&i.enableFormElements(t(this))}),t(function(){i.refreshCSRFTokens()}))}(jQuery),function(t){t.fn.rwdImageMaps=function(){var e=this,i=function(){e.each(function(){if("undefined"!=typeof t(this).attr("usemap")){var e=this,i=t(e);t("<img />").load(function(){var e="width",r="height",a=i.attr(e),n=i.attr(r);if(!a||!n){var s=new Image;s.src=i.attr("src"),a||(a=s.width),n||(n=s.height)}var o=i.width()/100,c=i.height()/100,l=i.attr("usemap").replace("#",""),u="coords";t('map[name="'+l+'"]').find("area").each(function(){var e=t(this);e.data(u)||e.data(u,e.attr(u));for(var i=e.data(u).split(","),r=new Array(i.length),s=0;s<r.length;++s)r[s]=parseInt(s%2===0?i[s]/a*100*o:i[s]/n*100*c);e.attr(u,r.toString())})}).attr("src",i.attr("src"))}})};return t(window).resize(i).trigger("resize"),this}}(jQuery),function(t){t(".button__filter").on("click",function(){t(this).toggleClass("is-active")}),t("#jsTypeProduitSelect").on("change",function(){t("#jsTypeProduitSelect option:selected ").text()}),t(".button__categorie").on("click",function(){t(this).toggleClass("is-active")}),t.urlParam=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))};var e=[];t.ajax("/listeProduit.json",{async:!1,success:function(t){e=t}});var i=FilterJS(e,"#produits",{template:"#produitTemplate",search:{ele:"#toto"},callbacks:{beforeRecordRender:function(t){t.liste__item__class="","undefined"==typeof t.description&&(t.description=""),"Le constat"==t.etape?t.liste__item__class+="liste__item--constat":"L'analyse"==t.etape?t.liste__item__class+="liste__item--analyse":"La décision"==t.etape?t.liste__item__class+="liste__item--decision":"L'action"==t.etape?t.liste__item__class+="liste__item--action":"Cap vers la Cohérence"==t.etape&&(t.liste__item__class+="liste__item--cap"),"Formation"==t.categorie?t.liste__item__class+=" liste__item--formation":"Outils"==t.categorie?t.liste__item__class+=" liste__item--outils":"Bibliothèque"==t.categorie?t.liste__item__class+=" liste__item--bibliotheque":"Ebook"==t.categorie&&(t.liste__item__class+=" liste__item--ebook")}}});i.addCriteria({field:"categorie",ele:"#filterCategories input:checkbox"}),i.addCriteria({field:"etape",ele:"#filterEtapes input:checkbox"}),i.filter(),t(".button__filter, .button__categorie").click(function(e){e.preventDefault(),$target=t(this).data("target-filter"),$target&&($target_is_checked=t("#filters").find("[data-filter="+$target+"]").first(),$target_is_checked.trigger($target_is_checked.prop("checked")?"click":"click"))});var r=t.urlParam("categories")?t.urlParam("categories").split(","):[],a=t.urlParam("etapes")?t.urlParam("etapes").split(","):[];if(r.length>0)for(var n=0;n<r.length;n++)t(".button__categorie--"+r[n]).trigger("click");if(a.length>0)for(var n=0;n<a.length;n++)t(".button__filter--"+a[n]).trigger("click")}(jQuery)(function(t){"use strict";var e=function(t,e){return new a(t,e||{})};t.JsonQuery=e,e.VERSION="0.0.2",Object.defineProperty||(Object.defineProperty=function(t,e,i){t[e]=i.get});var i=function(t,e,i){if(t.length===+t.length)for(var r=0,a=t.length;a>r;r++)e.call(i,t[r],r);else for(var n in t)hasOwnProperty.call(t,n)&&e.call(i,t[n],n)},r=function(t,e,i){for(var r=0,a=t.length;a>r;r++)if(e.call(i,t[r],r)===!1)return},a=function(t,e){this.records=t||[],this.getterFns=e.getterFns||{},this.lat=e.latitude||"latitude",this.lng=e.longitude||"longitude",this.id=e.id,this.records.length&&s(this,t[0],e.schema)},n=a.prototype,s=function(t,e,i){t.schema={},t.id||(t.id=e._id?"_id":"id"),i||(c.call(t,e),l.call(t,e))},o=function(t){if(null==t)return"String";var e=Object.prototype.toString.call(t).slice(8,-1);return"String"==e&&t.match(/\d{4}-\d{2}-\d{2}/)?"Date":e},c=function(t,e){var i,r,a,n;for(i in t)n=t[i],r=o(n),a=e?e+"."+i:i,this.schema[a]=r,"Object"==r?c.call(this,n,a):"Array"==r&&(["Object","Array"].indexOf(o(n[0]))>-1?c.call(this,t[i][0],a):this.schema[a]=o(n[0]))},l=function(t){var e,i,r;for(e in this.schema){i=this.schema[e];try{this.getterFns[e]||(this.getterFns[e]=h.call(this,e,i)),r=this.getterFns[e](t),"Array"==o(r)&&(this.schema[e]="Array")}catch(a){console.log("Error while generating getter function for selector : "+e+" NOTE: Define manually")}}},u=function(t,e){for(var i,r=0,a=0,n=e.length-1,s=e.length-1;s>=0;s--)i=e.slice(0,s+1).join("."),"Array"==t[i]&&n>s&&(r=s,a+=1);return a>1?r+1:-1},h=function(t){for(var e,i,r,a="",n=t.split("."),s=u(this.schema,n),o=n.length-1;o>=0;o--)e=n.slice(0,o+1).join("."),i="['"+n[o]+"']",a="Array"==this.schema[e]?s==o?i+(a.length?".map(function(r"+o+"){  objs.push(r"+o+a+")})":""):i+(a.length?".map(function(r"+o+"){  return r"+o+a+"})":""):i+a;return r=s>-1?"var objs = []; obj"+a+";"+("Date"==this.schema.path?"return parseDate(objs)":"return objs;"):"return "+("Date"==this.schema.path?"parseDate(obj"+a+");":"obj"+a+";"),new Function("obj",r)};n.operators={eq:function(t,e){return t==e},ne:function(t,e){return t!=e},lt:function(t,e){return e>t},lte:function(t,e){return e>=t},gt:function(t,e){return t>e},gte:function(t,e){return t>=e},"in":function(t,e){return e.indexOf(t)>-1},ni:function(t,e){return-1==e.indexOf(t)},li:function(t,e){return e.test(t)},bt:function(t,e){return t>=e[0]&&t<=e[1]}},n.addOperator=function(t,e){this.operators[t]=e};var f=function(t,e,i){var r=0,a=t.length;for(r;a>r;r++)if(i(t[r],e))return!0};n.addCondition=function(t,e){this.operators[t]=e},n.getCriteria=function(t){var e=t.split(".$");return{field:e[0],operator:e[1]||"eq"}},n.setGetterFn=function(t,e){this.getterFns[t]=e},n.addRecords=function(t){return t&&t.length?("Array"==o(t)?this.records=this.records.concat(t):this.records.push(t),this.schema||s(this,t[0]),!0):!1},n._findAll=function(t,e,r,a){var n,s,o,c=[],l=this.getterFns[e];return"li"==a&&"string"==typeof r&&(r=new RegExp(r)),n=this.operators[a],"Array"==this.schema[e]&&(o=n,n=f),i(t,function(t){s=l(t),n(s,r,o)&&c.push(t)}),c},n.find=function(t,e){var i,a;return e||(e=t,t=this.id),a=this.getterFns[t],r(this.records,function(t){return a(t)==e?(i=t,!1):void 0}),i},i(["where","or","groupBy","select","pluck","limit","offset","order","uniq","near"],function(t){n[t]=function(){var e=new y(this,this.records);return e[t].apply(e,arguments),e}}),i(["count","first","last","all"],function(t){Object.defineProperty(n,t,{get:function(){return new y(this,this.records)[t]}})});var d=function(t,e,i){for(var r=0,a=i.length;a>r;r++)if(this.getterFns[i[r]](t)!==this.getterFns[i[r]](e))return!1;return!0},m=function(t,e){var i,r,a;for(i in t)r=this.jQ.getCriteria(i),a=this.jQ._findAll(a||e,r.field,t[i],r.operator);return a},p=function(t,e){{var r,a=this.jQ.getterFns[t],n={};e.length}return i(e,function(t){r=a(t),(n[r]||(n[r]=[])).push(t)}),n},g=function(t,e){for(var i,r,a=e.slice(0),n=0,s=t.length;s>n;n++)i=this.jQ.getterFns[t[n].field],r="asc"==t[n].direction?1:-1,a.sort(function(t,e){var a=i(t),n=i(e);return(n>a?-1:a>n?1:0)*r});return a},b=function(t,e){var r,a=this,n=[];return i(t,function(t){r=a.jQ.getterFns[t],i(e,function(e,i){(n[i]||(n[i]={}))[t]=r(e)})}),n},v=function(t,e){var r=this.jQ.getterFns[t],a=[];return i(e,function(t){a.push(r(t))}),a},_=function(t,e){var r=[],a=this;return"Object"!=o(e[0])?(i(e,function(t){-1==r.indexOf(t)&&r.push(t)}),r):(r.push(e[0]),i(e,function(e){for(var i=!1,n=0,s=r.length;s>n;n++)d.call(a.jQ,r[n],e,t)&&(i=!0);i||r.push(e)}),r)},y=function(t,e){return this.jQ=t,this.records=e,this.criteria={},this},j=y.prototype;j.each=function(t,e){i(this.exec()||[],t,e)},j.exec=j.toArray=function(t){var e;return this.criteria.all&&(e=this.records),this.criteria.where&&(e=m.call(this,this.criteria.where,e||this.records)),this.criteria.or&&(e=e.concat(m.call(this,this.criteria.or,this.records)),e=_.call(this,[this.jQ.id],e)),this.criteria.order&&(e=g.call(this,this.criteria.order,e||this.records)),this.criteria.near&&(e=x.call(this,this.criteria.near,e||this.records)),this.criteria.uniq&&(e=_.call(this,this.criteria.uniq,e||this.records)),this.criteria.select&&(e=b.call(this,this.criteria.select,e||this.records)),this.criteria.pluck&&(e=v.call(this,this.criteria.pluck,e||this.records)),this.criteria.limit&&(e=(e||this.records).slice(this.criteria.offset||0,(this.criteria.offset||0)+this.criteria.limit)),this.criteria.group_by&&(e=p.call(this,this.criteria.group_by,e||this.records)),t&&i(e||this.records,t),e||(e=this.records),this.jQ.onResult&&this.jQ.onResult(e,this.criteria),e};var k=function(t,e){var i;this.criteria[t]||(this.criteria[t]={});for(i in e)this.criteria[t][i]=e[i];return this};j.where=function(t){return k.call(this,"where",t)},j.or=function(t){return k.call(this,"or",t)},j.groupBy=function(t){return this.criteria.group_by=t,this},j.select=function(){return this.criteria.select=arguments,this},j.pluck=function(t){return this.criteria.pluck=t,this},j.limit=function(t){return this.criteria.limit=t,this},j.offset=function(t){return this.criteria.offset=t,this},j.order=function(t){var e;this.criteria.order=this.criteria.order||[];for(e in t)this.criteria.order.push({field:e,direction:t[e].toLowerCase()});return this},j.uniq=function(){return this.criteria.uniq=arguments.length>0?arguments:!0,this},Object.defineProperty(j,"count",{get:function(){this.criteria.count=!0;var t=this.exec();return"Array"==o(t)?this.exec().length:Object.keys(t).length}}),Object.defineProperty(j,"all",{get:function(){return this.criteria.all=!0,this.exec()}}),Object.defineProperty(j,"first",{get:function(){return this.criteria.first=!0,this.exec()[0]}}),Object.defineProperty(j,"last",{get:function(){this.criteria.last=!0;var t=this.exec();return t[t.length-1]}});var w={redius:6371,toRad:function(t){return t*Math.PI/180}},S=function(t,e,i,r){var a=w.toRad(e-t),n=w.toRad(r-i),t=w.toRad(t),e=w.toRad(e),s=Math.sin(a/2)*Math.sin(a/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(t)*Math.cos(e);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*w.redius},x=function(t,e){var r=[],a=this,n="mile"==t.unit?.6214:1,s=a.jQ.getterFns[a.jQ.lat],o=a.jQ.getterFns[a.jQ.lng];return i(e,function(e){e._distance=S(s(e),t.lat,o(e),t.lng)*n,e._distance<=t.distance&&r.push(e)}),r.sort(function(t,e){return t._distance<e._distance?-1:t._distance>e._distance?1:0}),r};j.near=function(t,e,i,r){return this.criteria.near={lat:t,lng:e,distance:i,unit:r||"km"},this},j.map=j.collect=function(t){var e,i=[];return this.exec(function(r){(e=t(r))&&i.push(e)}),i},j.sum=function(t){var e,r=0,a=this.jQ.getterFns[t];return this.criteria.group_by&&(e=!0,r={}),this.exec(function(t,n){e?(r[n]=0,i(t,function(t){r[n]=r[n]+(a(t)||0)})):r+=a(t)||0}),r},j.toJQ=function(){var t=e(this.all,{schema:!0});return t.schema=this.jQ.schema,t.getterFns=this.jQ.getterFns,t}})(this),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){for(var i=e||0,r=this.length;r>i;i++)if(this[i]===t)return i;return-1}),function(t,e,i){"use strict";var r=function(t,e,i){var n=new a(t,e,i);return r.list.push(n),n};r.VERSION="2.0.0",r.list=[],t.fn.filterjs=function(e,i){var a=t(this);a.data("fjs")||a.data("fjs",r(e,a,i))},e.FilterJS=r;var a=function(e,i,r){var a=this;this.opts=r||{},this.callbacks=this.opts.callbacks||{},this.$container=t(i),this.view=this.opts.view||o,this.templateFn=this.template(t(this.opts.template).html()),this.criterias=[],this._index=1,t.each(this.opts.criterias||[],function(){a.addCriteria(this)}),this.Model=JsonQuery(),this.Model.getterFns._fid=function(t){return t._fid},this.addRecords(e)},n=a.prototype;Object.defineProperty(n,"records",{get:function(){return this.Model.records}}),Object.defineProperty(n,"recordsCount",{get:function(){return this.Model.records.length}});var s={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};n.template=function(t,e){var i=s,r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(i.escape,function(t,e){return"',escapeStr("+e.replace(/\\'/g,"'")+"),'"}).replace(i.interpolate,function(t,e){return"',"+e.replace(/\\'/g,"'")+",'"}).replace(i.evaluate||null,function(t,e){return"');"+e.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",a=new Function("obj",r);return e?a(e):function(t){return a(t)}},n.execCallback=function(t,e){this.callbacks[t]&&this.callbacks[t].call(this,e)},n.addCallback=function(t,e){t&&e&&(this.callbacks[t]=e)},n.addRecords=function(t){!!this.Model.schema;this.execCallback("beforeAddRecords",t),this.Model.addRecords(t)&&(this.has_scheme||this.initSearch(this.opts.search),this.render(t),this.filter()),this.execCallback("afterAddRecords",t)},n.removeRecords=function(e){var i;if(t.isPlainObject(e)?i=this.Model.where(e).pluck("_fid").all:t.isArray(e)&&(i=this.Model.where({"id.$in":e}).pluck("_fid").all),!i)return!1;for(var r,a=this.Model.records,n=0,s=i.length,o=a.length-1;o>-1&&(r=a[o]._fid,i.indexOf(r)>-1&&(a.splice(o,1),n++,t("#fjs_"+r).remove()),n!=s);o--);return this.execCallback("afterRemove"),!0};var o=function(t){return this.templateFn(t)};n.render=function(e){var i,r=this;if(e.length){this.execCallback("beforeRender",e);var a="beforeRecordRender";t.each(e,function(e){r.execCallback(a,this),this._fid=r._index++,i=t(t.trim(r.view.call(r,this,e))),i.attr("id","fjs_"+this._fid),i.addClass("fjs_item"),r.$container.append(i)})}};var c=function(t){var e=t.$ele,i=t.$ele.attr("type");return t.selector||("INPUT"==e.get(0).tagName?t.selector="checkbox"==i||"radio"==i?":checked":":input":"SELECT"==e.get(0).tagName&&(t.selector="select")),t.event||(t.event="checkbox"==i||"radio"==i?"click":"change"),t};n.addCriteria=function(e){var i=this;return e?(t.isArray(e)?t.each(e,function(){l.call(i,this)}):l.call(i,e),!0):!1};var l=function(e){return e&&e.field&&e.ele?(e.$ele=t(e.ele),e.$ele.length?(e=c(e),this.bindEvent(e.ele,e.event),e._q=e.field+("range"==e.type?".$bt":""),e.active=!0,this.criterias.push(e),!0):!1):!1};n.removeCriteria=function(e){var i,r,a=this;t.each(a.criterias,function(t){this.field==e&&(r=t)}),null!=r&&(i=this.criterias.splice(r,1)[0],t("body").off(i.event,i.ele))};var u=function(e,i){var r=this;e&&(t.isArray(e)||(e=[e]),t.each(e,function(){var e=this;t.each(r.criterias,function(){this.field==e&&(this.active=i)})}))};n.deactivateCriteria=function(t){u.call(self,t,!1)},n.activateCriteria=function(t){u.call(this,t,!0)};var h=function(e,i){var r=[];return e.$ele.filter(e.selector).each(function(){r.push(t(this).val())}),t.isArray(r[0])&&(r=[].concat.apply([],r)),e.all&&r.indexOf(e.all)>-1?[]:("range"==e.type&&(r=r[0].split("-")),i.execCallback("onFilterSelect",{criteria:e,values:r})||r)};n.lastResult=function(){return this.last_result||this.records},n.filter=function(){var e,i,r={},a=0,n=this;return t.each(this.criterias,function(){this.active&&(e=h(this,n),e&&e.length&&(i=t.isArray(e)&&!this.type?this._q+".$in":this._q,r[i]=e,a+=1))}),this.last_result=a?this.Model.where(r).all:this.Model.all,this.searchFilter(this.last_result)?r:(this.show(this.last_result),this.execCallback("afterFilter",this.last_result),r)},n.show=function(e){t(".fjs_item").hide();for(var i=0,r=e.length;r>i;i++)t("#fjs_"+e[i]._fid).show()},n.filterTimer=function(t){var e=this;this.filterTimeoutId&&clearTimeout(this.filterTimeoutId),this.filterTimeoutId=setTimeout(function(){e.filter()},t)},n.bindEvent=function(e,r){var a=this;t(i).on(r,e,function(){a.filterTimer(a.opts.timeout||30)})},n.initSearch=function(e){(e||e.ele)&&(e.start_length||(this.opts.search.start_length=2),this.$search_ele=t(this.opts.search.ele),this.$search_ele.length&&(this.has_search=!0,this.searchFn=this.buildSearchFn(e.fields),this.bindEvent(e.ele,"keyup")))},n.buildSearchFn=function(e){var i=this,r=[];return e?t.each(e,function(){r.push(i.Model.getterFns[this])}):t.each(i.Model.getterFns,function(t,e){r.push(e)}),function(t,e){t=t.toLocaleUpperCase();for(var i=0,a=r.length;a>i;i++)if((r[i](e)+"").toLocaleUpperCase().indexOf(t)>-1)return!0;return!1}},n.searchFilter=function(e){if(this.has_search){var i,r=t.trim(this.$search_ele.val());return r.length<this.opts.search.start_length?!1:(i=this.search(r,e||this.lastResult()),this.show(i),this.execCallback("afterFilter",i),!0)}},n.search=function(t,e){t=t.toLocaleUpperCase();for(var i=[],r=0,a=e.length;a>r;r++)this.searchFn(t,e[r])&&i.push(e[r]);return i},n.setStreaming=function(t){t&&(this.opts.streaming=t,t.data_url&&(t.stream_after=1e3*(t.stream_after||2),t.batch_size=t.batch_size||!1,this.streamData(t.stream_after)))};var f=function(){var e=this,i=this.opts.params||{},r=this.opts.streaming;i.offset=this.recordsCount,r.batch_size&&(i.limit=r.batch_size),this.has_search&&(i.q=t.trim(this.$search_ele.val())),t.getJSON(r.data_url,i).done(function(t){null==i.limit||t&&t.length?(e.setStreamInterval(),e.addRecords(t)):e.stopStreaming()}).fail(function(){e.stopStreaming()})};n.setStreamInterval=function(){var t=this;1!=t.opts.streaming.stop&&(t.streamingTimer=setTimeout(function(){f.call(t)},t.opts.streaming.stream_after))},n.stopStreaming=function(){this.opts.streaming.stop=!0,this.streamingTimer&&clearTimeout(this.streamingTimer)},n.resumeStreaming=function(){this.opts.streaming.stop=!1,this.streamData(this.opts.streaming.stream_after)},n.streamData=function(){this.setStreamInterval(),this.opts.streaming.batch_size||this.stopStreaming()}}(jQuery,window,document),function(t){jQuery.fn.videoYT=function(e){var i="";e=e.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),void 0!==e[2]?(i=e[2].split(/[^0-9a-z_\-]/i),i=i[0]):i=e,t(this).html('<iframe width="100%" height="auto" src="https://www.youtube-nocookie.com/embed/'+i+'?rel=0&modestbranding=1&autohide=1&showinfo=0" frameborder="0" allowfullscreen>test</iframe>')}}(jQuery);